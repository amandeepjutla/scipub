estype <- ifelse(type == "mixed", "OR=", "")
tableout$es <- paste0(
estype,
format(round(stats::fisher.test(x, y)$estimate, round_n),
nsmall = round_n
)
)
} else if (length(levels(x)) > 2 & groupvar != "onecol") {
# calculate effect size - cramer v
estype <- ifelse(type == "mixed", "V=", "")
tableout$es <- paste0(
estype,
format(round(sqrt((stats::chisq.test(y, x)$statistic) / (sum(stats::complete.cases(cbind(y, x))) * stats::chisq.test(y, x)$parameter)), round_n),
nsmall = round_n
)
)
}
# IF MORE THAN 2 LEVELS
} else {
tableout$Variable <- outcome
tableout[2:(1 + length(levels(y))), grplvl] <- datafile %>%
tidyr::drop_na(tidyselect::all_of(outcome)) %>%
dplyr::group_by_at(c(groupvar, outcome)) %>%
dplyr::select_at(outcome) %>%
tally() %>%
dplyr::ungroup() %>%
dplyr::group_by_at(c(groupvar)) %>%
dplyr::mutate(perc = 100 * n / sum(n)) %>%
dplyr::mutate_at(c("perc"), round, round_n) %>%
tidyr::unite("col", n, perc, sep = " (") %>%
dplyr::mutate(col = stringr::str_c(col, "%)")) %>%
tidyr::spread(groupvar, "col") %>%
dplyr::select(-c(tidyselect::all_of(outcome)))
tableout$Variable[2:(1 + length(levels(y)))] <- levels(y)
# calculate effect size - cramer v
estype <- ifelse(type == "mixed", "V=", "")
if (groupvar != "onecol") {
tableout$es[1] <- paste0(
estype,
format(round(sqrt((stats::chisq.test(y, x)$statistic) / (sum(stats::complete.cases(cbind(y, x))) * stats::chisq.test(y, x)$parameter)), round_n),
nsmall = round_n
)
)
}
}
}
# set p for all test types
if (groupvar != "onecol") {
tableout$sig[1] <- ifelse(p < .001, "***", ifelse(p < .01, "**", ifelse(p < .05, "*", "")))
tableout$p[1] <- ifelse(p < .001, "<.001",
ifelse(p < .01, sub(format(round(p, 3), nsmall = 3), pattern = "0.", replacement = "."),
sub(format(round(p, 2), nsmall = 2), pattern = "0.", replacement = ".")
)
)
}
return(tableout)
}
# iterate on all variables
finaltable <- do.call("rbind", lapply(vars, function(x) grouptests(datafile = data_edit, groupvar = strata, outcome = x)))
# FINAL FORMATTING
# remove es if not requested
if (!es_col[1]) {
finaltable <- finaltable %>% dplyr::select(-c(es))
}
# remove p if not requested
if (!p_col[1]) {
finaltable <- finaltable %>% dplyr::select(-c(p))
}
# remove p if not requested
if (strata == "onecol") {
finaltable <- finaltable %>% dplyr::select(-c(Stat))
}
if (stars[1] == "name") {
finaltable <- finaltable %>%
tidyr::unite(Variable, Variable, sig, sep = " ")
} else if (stars[1] == "stat") {
finaltable <- finaltable %>% tidyr::unite(Stat, Stat, sig, sep = " ")
} else if (stars[1] == "none") {
finaltable <- finaltable %>% dplyr::select(-c(sig))
}
# caption
missing_n <- data_edit %>%
dplyr::select(tidyselect::all_of(vars)) %>%
purrr::set_names(var_names) %>%
dplyr::mutate_all(is.na) %>%
dplyr::summarise_all(sum) %>%
dplyr::select_if(function(sum) sum > 0)
missingness <- ifelse(ncol(missing_n) > 0,
paste0(stringr::str_c(
"N=", missing_n,
" missing ", colnames(missing_n), ". "
),
collapse = ""
),
""
)
caption <- paste0(
"Note. ",
ifelse(sum(is.na(data[[strata]])) > 0,
paste0(
"N=", sum(is.na(data[[strata]])),
" excluded for missing group variable. "
), ""
),
missingness,
ifelse(strata == "onecol", "", "* p<.05, ** p<.01, *** p<.001")
)
# check if htmlTable installed
if (html[1] == T & !requireNamespace("htmlTable", quietly = TRUE)) {
warning("library(htmlTable) is needed for HTML format output,
please install and try again")
html <- FALSE
}
if (html[1] == T) {
return(print(htmlTable::htmlTable(finaltable,
useViewer = TRUE, rnames = FALSE,
caption = caption,
pos.caption = "bottom"
)))
} else {
return(list(
table = noquote(as.data.frame(finaltable, row.names = NULL)),
caption = caption
))
}
}
FullTable1(df,strata = "SexF",html=T)
colnames(df)
colnames(df) <- c("Age","Sex","Income","Height","iq","depressT","anxT")
save(df,file = "/Users/david/Dropbox (Personal)/scipub/data/psydat.Rda")
ds
df
names(df)
summary(df)
ABCD_merge$CognitionTotal
df <- ABCD_merge[,c("Age","SexF","Income3","Height","CognitionTotal","CBCL_DSM_MDD_T","CBCL_DSM_Anx_T")]
df$SexF[df$SexF==0] <- "M"
df$SexF[df$SexF==1] <- "F"
df$SexF <- as.factor(df$SexF)
df <- sample_n(df,size = 5000)
df$Age[!is.na(df$Age)] <- df$Age[!is.na(df$Age)] + rnorm(n = sum(!is.na(df$Age)), mean=2, sd=1)
df$Height[!is.na(df$Height)] <- df$Height[!is.na(df$Height)] + rnorm(sum(!is.na(df$Height)), mean=2, sd=1)
df$CognitionTotal[!is.na(df$CognitionTotal)] <- df$CognitionTotal[!is.na(df$CognitionTotal)] + rnorm(sum(!is.na(df$CognitionTotal)), mean=2, sd=1)
df$CBCL_DSM_MDD_T[!is.na(df$CBCL_DSM_MDD_T)] <- df$CBCL_DSM_MDD_T[!is.na(df$CBCL_DSM_MDD_T)] + rnorm(sum(!is.na(df$CBCL_DSM_MDD_T)), mean=2, sd=1)
df$CBCL_DSM_Anx_T[!is.na(df$CBCL_DSM_Anx_T)] <- df$CBCL_DSM_Anx_T[!is.na(df$CBCL_DSM_Anx_T)] + rnorm(sum(!is.na(df$CBCL_DSM_Anx_T)), mean=2, sd=1)
colnames(df) <- c("Age","Sex","Income","Height","iq","depressT","anxT")
save(df,file = "/Users/david/Dropbox (Personal)/scipub/data/psydat.Rda")
summary(df)
#' Sample demographic and clinical data for 5,000 children
#'
#' A dataset containing demographic and clinical
#' data for 5,000 children. The variables are as follows:
#'
#' @format A data frame with 5000 rows and 7 variables:
#' \describe{
#'   \item{Age}{age in months (107.2--136.4)}
#'   \item{Sex}{biological sex, 4 missing value (M, F)}
#'   \item{Income}{reported family income, 404 missing values (<50K, >=100K, >=50K&<100K)}
#'   \item{Height}{height in inches, 7 missing values (36.05--84.51)}
#'   \item{iq}{cognition test, 179 missing values (34.86--222.99)}
#'   \item{depressT}{depression symptom severity T-score, 8 missing values (48.53--91.32)}
#'   \item{anxT}{anxiety symptom severity T-score, 8 missing values (48.76--93,67)}
#' }
"psydat"
psydat<-df
apastat(stats::cor.test(psydat$Age, psydat$Height))
apastat(stats::t.test(Height ~ Sex, data = psydat))
apastat(stats::t.test(Height ~ Sex, data = psydat))
apastat(stats::lm(data = psydat, Height ~ Age + Sex))
apastat(stats::lm(data = psydat, Height ~ Age + Sex), var = "Age")
correltable(data = psydat, vars = c("Age", "Height", "iq"),tri="lower",html=TRUE)
correltable(data = psydat, vars = c("Age", "Height", "iq"), var_names = c("Age (months)", "Height (inches)", "IQ"), tri = "upper", colnum = TRUE,html=TRUE)
correltable(data = psydat, vars = c("Age", "Height", "iq"), var_names = c("Age (months)", "Height (inches)", "IQ"), vars2 = c("depressT", "anxT"), var_names2 = c("Depression T", "Anxiety T"),html=TRUE)
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
library(knitr)
correltable(data = psydat, html=TRUE)
FullTable1(data = psydat, vars = c("Age", "Height", "depressT"), strata = "Sex")
FullTable1(data = psydat, vars = c("Age", "Height", "depressT"),  html=TRUE)
FullTable1(data = psydat, vars = c("Age", "Sex","Height", "depressT"), var_names = c("Age (months)", "Sex","Height (inches)", "Depression T"), strata = "Income", stars = "name",p_col = FALSE, html=TRUE)
FullTable1(data = psydat, vars = c("Age", "Sex","Height", "depressT"), var_names = c("Age (months)", "Sex","Height (inches)", "Depression T"), strata = "Income", stars = "name",p_col = FALSE, html=TRUE)
FullTable1(data = psydat, strata = "Sex", html=TRUE)
FullTable1(data = psydat, strata = "Sex",stars = "stats",p_col = FALSE, html=TRUE)
FullTable1(data = psydat, strata = "Sex",stars = "stat",p_col = FALSE, html=TRUE)
FullTable1(data = psydat, vars = c("Age", "Sex","Height", "depressT"), var_names = c("Age (months)", "Sex","Height (inches)", "Depression T"), strata = "Income", stars = "stat",p_col = FALSE, html=TRUE)
winsorZ_find(psydat$iq)
table(winsorZ_find(psydat$iq))
temp <- psydat$iq
temp$iq_winsor <- winsorZ(psydat$iq)
temp$iq_outlier <- winsorZ_find(psydat$iq)
temp
temp <- data.frame(iq=psydat$iq, iq_winsor=winsorZ(psydat$iq), iq_outlier = winsorZ_find(psydat$iq))
temp
library(ggplot2)
summary(temp)
ggplot(temp, aes(x=iq, y=iq_winsor)) + geom_point(aes(color=iq_outlier)) + geom_line()
ggplot(temp[!is.na(temp$iq),], aes(x=iq, y=iq_winsor)) + geom_point(aes(color=iq_outlier)) + geom_line() + theme_bw()
ggplot(temp[!is.na(temp$iq),], aes(x=iq, y=iq_winsor)) + geom_point(aes(color=iq_outlier),alpha=.7) + geom_line() + theme_bw()
devtools::install_github("dpagliaccio/scipub",force=T)
library(scipub)
#' Sample demographic and clinical data for 5,000 children
#'
#' A dataset containing demographic and clinical
#' data for 5,000 children. The variables are as follows:
#'
#' @format A data frame with 5000 rows and 7 variables:
#' \describe{
#'   \item{Age}{age in months (107.2--136.4)}
#'   \item{Sex}{biological sex, 4 missing value (M, F)}
#'   \item{Income}{reported family income, 404 missing values (<50K, >=100K, >=50K&<100K)}
#'   \item{Height}{height in inches, 7 missing values (36.05--84.51)}
#'   \item{iq}{cognition test, 179 missing values (34.86--222.99)}
#'   \item{depressT}{depression symptom severity T-score, 8 missing values (48.53--91.32)}
#'   \item{anxT}{anxiety symptom severity T-score, 8 missing values (48.76--93,67)}
#' }
"psydat"
psydat <- df
psydat <- df
save(psydat,file = "/Users/david/Dropbox (Personal)/scipub/data/psydat.Rda")
devtools::use_data(psydat, scipub)
usethis::use_data(psydat, scipub)
devtools::install_github("dpagliaccio/scipub",force=T)
library(scipub)
usethis::use_data(psydat, scipub, overwrite=T)
usethis::use_data(psydat, overwrite=T)
library(scipub)
apastat(stats::cor.test(psydat$Age, psydat$Height), ci = TRUE)
usethis::use_data(psydat, overwrite=T)
apastat(stats::cor.test(psydat$Age, psydat$Height), ci = TRUE)
data
tools::checkRdaFiles()
tools::checkRdaFiles("/Users/David/Dropbox (Personal)/scipub/")
tools::checkRdaFiles("/Users/David/Dropbox (Personal)/scipub/data/")
tools::checkRdaFiles("/Users/David/Dropbox (Personal)/scipub/R/")
tools::checkRdaFiles("/Users/David/Dropbox (Personal)/scipub/man/")
devtools::install_github("dpagliaccio/scipub",force=T)
library(scipub)
scipub::diamonds
devtools::check(document = T,cran = F)
devtools::check(document = T,cran = F,vignettes = F)
devtools::check(document = T,cran = F,vignettes = F)
devtools::check(document = T,cran = F,vignettes = T)
devtools::install_github("dpagliaccio/scipub",force=T)
library(scipub)
apastat(stats::cor.test(psydat$Age, psydat$Height), ci = TRUE)
apastat(stats::cor.test(psydat$Age, psydat$Height), ci = TRUE)
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
library(knitr)
library(ggplot2)
library(scipub)
apastat(stats::cor.test(psydat$Age, psydat$Height), ci = TRUE)
apastat(stats::t.test(Height ~ Sex, data = psydat))
apastat(stats::lm(data = psydat, Height ~ Age + Sex), var = "Age")
apastat(stats::lm(data = psydat, Height ~ Age + Sex), var = "Age")
correltable(data = psydat, vars = c("Age", "Height", "iq"),tri="lower",html=TRUE)
correltable(data = psydat, vars = c("Age", "Height", "iq"), var_names = c("Age (months)", "Height (inches)", "IQ"), tri = "upper", colnum = TRUE,html=TRUE)
FullTable1(data = psydat, vars = c("Age", "Sex","Height", "depressT"),  html=TRUE)
temp <- data.frame(iq=psydat$iq, iq_winsor=winsorZ(psydat$iq), iq_outlier = winsorZ_find(psydat$iq))
temp <- data.frame(iq=psydat$iq, iq_winsor=winsorZ(psydat$iq), iq_outlier = winsorZ_find(psydat$iq))
summary(temp)
ggplot(temp[!is.na(temp$iq),], aes(x=iq, y=iq_winsor)) + geom_point(aes(color=iq_outlier),alpha=.7) + geom_line() + theme_bw()
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
library(knitr)
library(ggplot2)
library(scipub)
apastat(stats::cor.test(psydat$Age, psydat$Height), ci = TRUE)
apastat(stats::t.test(Height ~ Sex, data = psydat))
apastat(stats::lm(data = psydat, Height ~ Age + Sex), var = "Age")
apastat(stats::lm(data = psydat, Height ~ Age + Sex), var = "Age")
correltable(data = psydat, vars = c("Age", "Height", "iq"),tri="lower",html=TRUE)
correltable(data = psydat, vars = c("Age", "Height", "iq"), var_names = c("Age (months)", "Height (inches)", "IQ"), tri = "upper", colnum = TRUE,html=TRUE)
correltable(data = psydat, vars = c("Age", "Height", "iq"), var_names = c("Age (months)", "Height (inches)", "IQ"), vars2 = c("depressT", "anxT"), var_names2 = c("Depression T", "Anxiety T"),html=TRUE)
correltable(data = psydat, html=TRUE)
FullTable1(data = psydat, vars = c("Age", "Sex","Height", "depressT"),  html=TRUE)
FullTable1(data = psydat, vars = c("Age", "Height", "depressT"), strata = "Sex", html=TRUE)
FullTable1(data = psydat, vars = c("Age", "Sex","Height", "depressT"), var_names = c("Age (months)", "Sex","Height (inches)", "Depression T"), strata = "Income", stars = "stat",p_col = FALSE, html=TRUE)
FullTable1(data = psydat, strata = "Sex",stars = "name",p_col = FALSE, html=TRUE)
psydat
psydat$Age
apastat(stats::cor.test(psydat$Age, psydat$Height), ci = TRUE)
apastat(stats::cor.test(psydat$Age, psydat$Height), ci = TRUE)
library(scipub)
apastat(stats::cor.test(psydat$Age, psydat$Height), ci = TRUE)
scipub::psydat
attach(scipub::psydat)
psydat
?psydat
devtools::check(document = T,cran = F,vignettes = T)
scipub::psydat
scipub::psydat
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
library(knitr)
library(ggplot2)
library(scipub)
scipub::psydat
unlink('doc/scipub_vignette_cache', recursive = TRUE)
apastat(stats::cor.test(scipub::psydat$Age, scipub::psydat$Height), ci = TRUE)
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
library(knitr)
library(ggplot2)
library(scipub)
apastat(stats::cor.test(scipub::psydat$Age, scipub::psydat$Height), ci = TRUE)
psydat
devtools::check(document = T,cran = F,vignettes = F)
scipub::psydat
data(psydat)
devtools::build_vignettes()
psydat
usethis::use_data_raw(psydat)
usethis::use_data(psydat)
devtools::check(document = T,cran = F,vignettes = T)
devtools::install_github("dpagliaccio/scipub",force=T)
psydat
scipub::psydat
devtools::check(document = T,cran = F,vignettes = F)
devtools::install_github("dpagliaccio/scipub",force=T)
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
library(knitr)
library(ggplot2)
library(scipub)
apastat(stats::cor.test(psydat$Age, psydat$Height), ci = TRUE)
data("psydat")
apastat(stats::cor.test(psydat$Age, psydat$Height), ci = TRUE)
devtools::check(document = T,cran = F,vignettes =T)
devtools::install_github("dpagliaccio/scipub",force=T)
library(scipub)
data("psydat")
data("psydat")
apastat(stats::cor.test(psydat$Age, psydat$Height), ci = TRUE)
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
library(knitr)
library(ggplot2)
apastat(stats::t.test(Height ~ Sex, data = psydat))
apastat(stats::t.test(Height ~ Sex, data = psydat))
apastat(stats::cor.test(psydat$Age, psydat$Height), ci = TRUE)
apastat(stats::t.test(Height ~ Sex, data = psydat))
cor.test(psydat$Age, psydat$Height)
apastat(stats::cor.test(psydat$Age, psydat$Height), ci = TRUE)
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
library(knitr)
library(ggplot2)
library(scipub)
data("psydat")
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
library(knitr)
library(ggplot2)
library(scipub)
data("psydat")
apastat(stats::cor.test(psydat$Age, psydat$Height), ci = TRUE)
data(psydat)
psydat <- data(psydat)
psydat <- data("psydat")
data(psydat)
data("psydat")
library(scipub)
data("psydat")
data(psydat)
library(scipub)
psydat
data()
library(scipub)
data(psydat)
data("psydat")
data("diamonds")
psydat
scipub::psydat
data(psydat)
library(scipub)
data(psydat)
devtools::install_github("dpagliaccio/scipub",force=T,dependencies = T)
library(scipub)
data(psydat)
data("psydat")
data(psydat,package = "scipub")
data("psydat",package = "scipub")
devtools::check(document = T,cran = F,vignettes =F)
devtools::check()
devtools::install_github("dpagliaccio/scipub",force=T,dependencies = T)
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
library(knitr)
library(ggplot2)
library(scipub)
data(psydat,package = "scipub",verbose = T)
data("psydat",package = "scipub",verbose = T)
data(list="psydat",package = "scipub",verbose = T)
data(list=psydat,package = "scipub",verbose = T)
help("scipub")
help(scipub)
psydat
data()
data(package="scipub")
data(package="base")
data(package="scipub")
data(package=scipub)
data(package=`scipub`)
load(file = "/Users/david/Dropbox (Personal)/scipub/data/psydat.rda")
#load(file = "/Users/david/Dropbox (Personal)/scipub/data/psydat.rda")
usethis::use_data(psydat)
#load(file = "/Users/david/Dropbox (Personal)/scipub/data/psydat.rda")
usethis::use_data(psydat, overwrite = T)
devtools::install_github("dpagliaccio/scipub",force=T,dependencies = T)
library(scipub)
data("psydat")
library(scipub)
data(psydat,package = "scipub")
data("psydat")
data("psydat")
data(psydat)
library(scipub)
data(psydat,package = "scipub")
data("psydat")
data(psydat)
apastat(stats::cor.test(psydat$Age, psydat$Height), ci = TRUE)
library(scipub)
data(psydat,package = "scipub")
data("psydat")
data(psydat)
apastat(stats::cor.test(psydat$Age, psydat$Height), ci = TRUE)
detach("package:scipub", unload = TRUE)
library(scipub)
data(psydat,package = "scipub")
data("psydat")
rm(list = ls())
data(psydat)
psydat <- data("psydat")
psydat <- data(psydat)
data(psydat)
apastat(stats::cor.test(psydat$Age, psydat$Height), ci = TRUE)
devtools::install()
spelling::spell_check_package()
spelling::spell_check_package()
spelling::spell_check_package()
styler:::style_active_pkg()
styler:::style_active_pkg()
g <- goodpractice::gp("/Users/David/Dropbox (Personal)/scipub/")
g$description
g$lintr
g$checks
g$rcmdcheck
install.packages("latexpdf")
g$lintr
lintr:::addin_lint()
lintr:::addin_lint()
lintr:::addin_lint()
lintr:::addin_lint()
lintr:::addin_lint()
lintr:::addin_lint()
lintr:::addin_lint()
lintr:::addin_lint()
lintr:::addin_lint()
lintr:::addin_lint()
lintr:::addin_lint()
lintr:::addin_lint()
lintr:::addin_lint()
lintr:::addin_lint_package()
styler:::style_active_pkg()
lintr:::addin_lint()
lintr:::addin_lint_package()
g <- goodpractice::gp("/Users/David/Dropbox (Personal)/scipub/")
g
g <- goodpractice::gp("/Users/David/Dropbox (Personal)/scipub/")
g
detach("package:scipub", unload = TRUE)
library(scipub)
library(dplyr)
g <- goodpractice::gp("/Users/David/Dropbox (Personal)/scipub/")
g
R CMD check
Rd2pdf
devtools::check(document = T,cran = F,vignettes =T)
#in terminal
system("R CMD Rd2pdf ~/Dropbox\ \(Personal\)/scipub")
#in terminal
system(command = "R CMD Rd2pdf ~/Dropbox\ \(Personal\)/scipub")
goodpractice::gp("/Users/David/Dropbox (Personal)/scipub/")
devtools::build()
devtools::check()
g <- goodpractice::gp("/Users/David/Dropbox (Personal)/scipub/")
g
#devtools::build_vignettes()
#load(file = "/Users/david/Dropbox (Personal)/scipub/data/psydat.rda")
#usethis::use_data(psydat, overwrite = T)
usethis::use_news_md()
